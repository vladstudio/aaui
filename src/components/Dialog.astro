---
import {Icon} from "astro-icon/components"
const {extraClass = "max-w-sm"} = Astro.props
---

<div
   x-id="['modal']"
   x-data="{ open: false }"
   x-transition.opacity
   @keydown.escape.window.stop.prevent="$dispatch('set-modal', {id: $id('modal'), open: false})"
   @set-modal.window="if ($event.detail.id==$id('modal')){\
      open = $event.detail.open; \
      document.body.style.overflowY = open ? 'hidden' : ''}">
   <!-- trigger -->
   <span
      class="inline-flex"
      @click="$dispatch('set-modal', {id: $id('modal'), open: true})"
      :disabled="open">
      <slot name="trigger" />
   </span>

   <template
      x-teleport="body"
      @click="$dispatch('set-modal', {id: $id('modal'), open: false})">
      <!-- backdrop -->
      <div
         x-cloak
         x-transition.opacity
         class="kBackdrop fixed left-0 top-0 z-50 flex h-[100dvh] w-[100dvw] items-center justify-center overflow-auto"
         x-show="open"
         x-trap="open">
         <!-- window -->
         <div
            class={extraClass + " mx-auto grid w-full kPaper text-left shadow-2xl  shadow-stone-900/20"}
            @click.stop>
            <!-- header -->
            <div class="flex w-full items-center truncate p-2">
               <h5 class="flex-1 truncate pl-2">
                  <slot name="title" />
               </h5>
               <button
                  class="kButton p-2"
                  @click="$dispatch('set-modal', {id: $id('modal'), open: false})">
                  <Icon name="ph:x-bold" size={16} class="text-stone-500" />
               </button>
            </div>

            <!-- content -->
            <div class="p-2">
               <slot />
            </div>
         </div>
      </div>
   </template>
</div>
